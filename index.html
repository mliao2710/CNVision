<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CNVision Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Exo 2 Font -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #0d0f12;
            color: #e0e0e0;
            font-family: "Exo 2", sans-serif;
        }

        .logo {
            position: absolute;
            top: 20px;
            left: 25px;
            width: 150px;
            height: auto;
            filter: drop-shadow(0 0 10px rgba(0, 200, 255, 0.75));
            animation: pulseGlow 3s infinite ease-in-out;
        }

        @keyframes pulseGlow {
            0% { filter: drop-shadow(0 0 8px rgba(0,200,255,0.6)); }
            50% { filter: drop-shadow(0 0 20px rgba(0,200,255,1)); }
            100% { filter: drop-shadow(0 0 8px rgba(0,200,255,0.6)); }
        }

        h1 {
            color: #00c8ff;
            font-weight: 700;
            text-shadow: 0 0 16px rgba(0,200,255,0.8);
            text-align: center;
            margin-top: 20px;
        }

        .subheading {
            color: #b0c7d1;
            font-size: 1.15rem;
            text-align: center;
            margin-bottom: 35px;
            opacity: 0.85;
        }

        h3 {
            color: #67d1ff;
            margin-top: 30px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0,150,255,0.6);
        }

        .card-dark {
            background-color: #15181d;
            border: 1px solid #1f242d;
            border-radius: 15px;
            padding: 22px;
            box-shadow: 0 0 20px rgba(0, 200, 255, 0.08);
            backdrop-filter: blur(4px);
        }

        .results-box {
            background-color: #111419;
            border-left: 4px solid #00eaff;
            box-shadow: 0 0 14px rgba(0, 240, 255, 0.15);
        }

        .examples-box {
            background-color: #151a20;
            border-left: 4px solid #569cd6;
            color: #cdd9e5;
            box-shadow: 0 0 14px rgba(86, 156, 214, 0.15);
        }

        .result-banner {
            background: linear-gradient(90deg, #00b7ff33, #00eaff66, #00b7ff33);
            border: 1px solid #00eaffaa;
            padding: 12px 15px;
            border-radius: 10px;
            text-align: center;
            color: #dff8ff;
            font-weight: 600;
            margin-bottom: 20px;
            opacity: 1;
            animation: fadeOut 3.5s forwards ease-in-out, glowPulse 2.5s infinite;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            60% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }

        @keyframes glowPulse {
            0% { box-shadow: 0 0 8px #00eaff55; }
            50% { box-shadow: 0 0 16px #00eaffaa; }
            100% { box-shadow: 0 0 8px #00eaff55; }
        }

        input, select {
            background-color: #0f1216 !important;
            color: #ffffff !important;
            border: 1px solid #28323f !important;
        }

        input:focus, select:focus {
            border-color: #00b7ff !important;
            box-shadow: 0 0 7px rgba(0,183,255,0.6) !important;
        }
    </style>
</head>

<body>

<img src="{{ url_for('static', filename='logo.png') }}" alt="CNVision Logo" class="logo">

<div class="container py-5">
    <h1>CNVision</h1>
    <p class="subheading">
        <strong>A Computational Framework to Predict Functional Impact of Intragenic Copy Number Variants</strong>
    </p>

    {% if result and result|length > 0 %}
    <div class="result-banner" id="resultBanner">
        ✅ CNV Successfully Analyzed — Scroll Down to View Results
    </div>
    {% endif %}

    <div class="card-dark">
        <form method="POST" class="mb-4">
            <h3>CNV Input</h3>

            <div class="mb-3">
                <label for="gene" class="form-label">Gene or NM_XXXXX ID:</label>
                <input type="text" class="form-control" id="gene" name="gene_input" required>
            </div>

            <div class="mb-3">
                <label class="form-label">CNV Type:</label>
                <select class="form-select" name="cnv_type" required>
                    <option value="deletion">Deletion</option>
                    <option value="duplication">Duplication</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Mode:</label>
                <select class="form-select" name="mode" required>
                    <option value="coordinate">Genomic coordinate</option>
                    <option value="exon">Exon numbers</option>
                </select>
            </div>

            <div class="mb-3" id="coordinate-fields">
                <label class="form-label">Start:</label>
                <input type="number" class="form-control" name="start">
                <label class="form-label mt-2">End:</label>
                <input type="number" class="form-control" name="end">
            </div>

            <div class="mb-3" id="exon-fields" style="display:none;">
                <label class="form-label">First exon:</label>
                <input type="number" class="form-control" name="first_exon">
                <label class="form-label mt-2">Last exon:</label>
                <input type="number" class="form-control" name="last_exon">
            </div>

            <button type="submit" class="btn btn-primary">Analyze CNV</button>
        </form>
    </div>

    <h3>Results</h3>
    <div class="card-dark results-box mb-4">
        <ul class="list-group">
            {% for r in result %}
            <li class="list-group-item">
                {% if r.error %}
                    {{ r.error }}
                {% else %}
                    <strong>Gene:</strong> {{ r.gene }}<br>
                    <strong>Transcript:</strong> {{ r.transcript }}<br>
                    <strong>Exons hit:</strong> {{ r.hit_exons }}<br>
                    <strong>Consequence:</strong> {{ r.predicted_consequence }}
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

    <h3 id="examplesToggle" style="cursor:pointer; display:flex; align-items:center; gap:10px;"
        data-bs-toggle="collapse" data-bs-target="#examplesCollapse">
        <span>Examples</span>
        <span id="arrowIcon" style="transition: transform 0.3s ease;">&#9656;</span>
    </h3>

    <div class="collapse" id="examplesCollapse">
        <div class="card-dark examples-box mt-2" style="opacity:0.75;">
            <ul class="list-group">
                {% for ex in examples %}
                    <li class="list-group-item example-item">
                        Gene: {{ ex.gene }},
                        {% if ex.start is defined and ex.end is defined %}
                            Start: {{ ex.start }},
                            End: {{ ex.end }},
                        {% elif ex.first_exon is defined and ex.last_exon is defined %}
                            First exon: {{ ex.first_exon }},
                            Last exon: {{ ex.last_exon }},
                        {% endif %}
                        Type: {{ ex.type }}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const examplesCollapse = document.getElementById("examplesCollapse");
const arrowIcon = document.getElementById("arrowIcon");

examplesCollapse.addEventListener("show.bs.collapse", () => {
    arrowIcon.style.transform = "rotate(90deg)";
});
examplesCollapse.addEventListener("hide.bs.collapse", () => {
    arrowIcon.style.transform = "rotate(0deg)";
});

const modeSelect = document.querySelector('select[name="mode"]');
const coordFields = document.getElementById('coordinate-fields');
const exonFields = document.getElementById('exon-fields');

modeSelect.addEventListener('change', () => {
    if (modeSelect.value === 'coordinate') {
        coordFields.style.display = 'block';
        exonFields.style.display = 'none';
    } else {
        coordFields.style.display = 'none';
        exonFields.style.display = 'block';
    }
});
</script>

</body>
</html>
